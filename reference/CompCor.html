<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Anatomical CompCor — CompCor • fMRIscrub</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Anatomical CompCor — CompCor"><meta property="og:description" content="The aCompCor algorithm for denoising fMRI data using noise ROIs data"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fMRIscrub</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.8.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/projection_scrubbing.html">Projection scrubbing for outlier detection in high-dimensional data with `fMRIscrub`</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/mandymejia/fMRIscrub/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Anatomical CompCor</h1>
    <small class="dont-index">Source: <a href="https://github.com/mandymejia/fMRIscrub/blob/master/R/CompCor.R"><code>R/CompCor.R</code></a></small>
    <div class="hidden name"><code>CompCor.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The aCompCor algorithm for denoising fMRI data using noise ROIs data</p>
    </div>

    <div class="ref-usage sourceCode"><pre class="sourceCode r"><code><span class="fu">CompCor</span><span class="op">(</span>
  <span class="va">X</span>,
  ROI_data <span class="op">=</span> <span class="st">"infer"</span>,
  ROI_noise <span class="op">=</span> <span class="cn">NULL</span>,
  noise_nPC <span class="op">=</span> <span class="fl">5</span>,
  noise_erosion <span class="op">=</span> <span class="cn">NULL</span>,
  center <span class="op">=</span> <span class="cn">TRUE</span>,
  scale <span class="op">=</span> <span class="cn">TRUE</span>,
  nuisance <span class="op">=</span> <span class="cn">NULL</span>
<span class="op">)</span></code></pre></div>

    <div id="arguments">
    <h2>Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <table class="ref-arguments"><colgroup><col class="name"><col class="desc"></colgroup><tr><th>X</th>
      <td><p>Wide numeric data matrix (\(T observations\) by \(V variables\), \(T &lt;&lt; V\)).
For example, if <code>X</code> represents an fMRI run, \(T\) should be the number
of timepoints and \(V\) should be the number of brainordinate vertices/voxels.</p>
<p>Or, a 4D array or NIFTI or file path to a NIFTI (\(I\) by \(J\) by \(K\) by \(T\)
observations), in which case <code>ROI_data</code> must be provided.
(The vectorized data will be \(T timepoints\) by \(V_{in-mask} voxels\))</p>
<p>Or, a <code>ciftiTools</code> <code>"xifti"</code> object or a file path to a CIFTI
(The vectorized data will be \(T timepoints\) by \(V_{left+right+sub} greyordinates\)).</p></td>
    </tr><tr><th>ROI_data</th>
      <td><p>Indicates the data ROI. Allowed arguments depend on <code>X</code>:</p>
<p>If <code>X</code> is a matrix, this must be a length \(V\) logical vector, where
the data ROI is indicated by <code>TRUE</code> values. If <code>"infer"</code> (default), all
columns of <code>X</code> will be included in the data ROI (<code>rep(TRUE, V)</code>).</p>
<p>If <code>X</code> is an array or NIFTI, this must be either a vector of values
to expect for out-of-mask voxels in <code>X</code>, or a (file path to a) 3D NIFTI.
In the latter case, each of the volume dimensions should match the first
three dimensions of <code>X</code>. Voxels in the data ROI should be indicated by
<code>TRUE</code> and all other voxels by <code>FALSE</code>. If <code>"infer"</code> (default),
will be set to <code>c(0, NA, NaN)</code> (include all voxels which are not constant
<code>0</code>, <code>NA</code>, or <code>NaN</code>).</p>
<p>If <code>X</code> is a <code>"xifti"</code> this must be the <code>brainstructures</code>
argument to <code><a href="https://rdrr.io/pkg/ciftiTools/man/read_cifti.html">read_cifti</a></code>. If <code>"infer"</code> (default),
<code>brainstructures</code> will be set to <code>"all"</code> (use both left and right
cortex vertices, and subcortical voxels).</p>
<p>If <code>NULL</code>, the data ROI will be empty. This is useful for obtaining just
the noise ROI, if the data and noise are located in separate files.</p></td>
    </tr><tr><th>ROI_noise</th>
      <td><p>Indicates the noise ROIs for aCompCor. Should be a list where
each entry corresponds to a distinct noise ROI. The names of the list should
be the ROI names, e.g. <code>"white_matter"</code> and <code>"csf"</code>. The expected
formats of the list entries depends on <code>X</code>:</p>
<p>For all types of <code>X</code>, <code>ROI_noise</code> entries can be a matrix of noise
ROI data. The matrix should have \(T\) rows, with each column being a
data location's timeseries.</p>
<p>If <code>X</code> is a matrix, entries can also indicate a noise ROI within <code>X</code>.
These entries must be a length \(V\) logical vector with <code>TRUE</code> values
indicating locations in <code>X</code> within that noise ROI. Since the ROIs must
not overlap, the masks must be mutually exclusive with each other, and with
<code>ROI_data</code>.</p>
<p>If <code>X</code> is an array or NIFTI, entries can also indicate a noise ROI within <code>X</code>.
These entries must be a logical array or (file path to) a 3D NIFTI with the
same spatial dimensions as <code>X</code>, and with <code>TRUE</code> values indicating
voxels inside the noise ROI. Since the ROIs must not overlap, the masks must
be mutually exclusive with each other, and with <code>ROI_data</code>.</p>
<p>(If <code>X</code> is a <code>"xifti"</code>, entries must be data matrices, since no
greyordinate locations in <code>X</code> are appropriate noise ROIs).</p></td>
    </tr><tr><th>noise_nPC</th>
      <td><p>The number of principal components to compute for each noise
ROI. Alternatively, values between 0 and 1, in which case they will
represent the minimum proportion of variance explained by the PCs used for
each noise ROI. The smallest number of PCs will be used to achieve this
proportion of variance explained.</p>
<p>Should be a list or numeric vector with the same length as <code>ROI_noise</code>.
It will be matched to each ROI based on the name of each entry, or if the
names are missing, the order of entries. If it is an unnamed vector, its
elements will be recycled. Default: <code>5</code> (compute the top 5 PCs for
each noise ROI).</p></td>
    </tr><tr><th>noise_erosion</th>
      <td><p>The number of voxel layers to erode the noise ROIs by.
Should be a list or numeric vector with the same length as <code>ROI_noise</code>.
It will be matched to each ROI based on the name of each entry, or if the
names are missing, the order of entries. If it is an unnamed vector, its
elements will be recycled. Default: <code>NULL</code>, which will use a value of
0 (do not erode the noise ROIs). Note that noise erosion can only be
performed if the noise ROIs are volumetric.</p></td>
    </tr><tr><th>center, scale</th>
      <td><p>Center the columns of the noise ROI data by their medians,
and scale by their MADs? Default: <code>TRUE</code> for both. Note that this argument
affects the noise ROI data and not the data that is being cleaned with aCompCor.
Centering and scaling of the data being cleaned can be done after this function call.</p></td>
    </tr><tr><th>nuisance</th>
      <td><p>Nuisance signals to regress from each data column in addition
to the noise ROI PCs. Should be a \(T\) by \(N\) numeric matrix where
\(N\) represents the number of nuisance signals. To not perform any nuisance
regression set this argument to <code>NULL</code>, <code>0</code>, or <code>FALSE</code>.
Default: <code>NULL</code>.</p></td>
    </tr></table></div>

    <div id="value">
    <h2>Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with entries <code>"data"</code>, <code>"noise"</code>, and potentially
<code>"ROI_data"</code>.</p>
<p>The entry <code>"data"</code> will be a <code>V x T</code> matrix where each row corresponds to a
data location (if it was originally an array, the locations will be voxels in spatial
order). Each row will be a time series with each noise PC regressed from it. This entry
will be <code>NULL</code> if there was no data.</p>
<p>The entry <code>"noise"</code> is a list of noise PC scores, their corresponding variance,
and their ROI mask, for each noise ROI.</p>
<p>If the data ROI is not all <code>TRUE</code>, the entry <code>"ROI_data"</code> will have
the ROI mask for the data.</p>
    </div>
    <div id="details">
    <h2>Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>First, the principal components (PCs) of each noise region of interest (ROI)
are calculated. For each ROI, voxels are centered and scaled
(can be disabled with the arguments <code>center</code> and <code>scale</code>),
and then the PCs are calculated via the singular value decomposition.</p>
<p>Next, aCompCor is performed to remove the shared variation between the noise ROI
PCs and each location in the data. This is accomplished by a nuisance regression
using a design matrix with the noise ROI PCs, any additional regressors specified
by <code>nuisance</code>, and an intercept term. (To detrend the data and perform aCompCor
in the same regression, <code>nuisance</code> can be set to DCT bases obtained with
the function <code><a href="dct_bases.html">dct_bases</a></code>.)</p>
    </div>
    <div id="references">
    <h2>References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    

<ul><li><p>Behzadi, Y., Restom, K., Liau, J. &amp; Liu, T. T. A component based noise correction method (CompCor) for BOLD and perfusion based fMRI. NeuroImage 37, 90-101 (2007).</p></li>
<li><p>Muschelli, J. et al. Reduction of motion-related artifacts in resting state fMRI using aCompCor. NeuroImage 96, 22-35 (2014).</p></li>
</ul></div>
    <div id="see-also">
    <h2>See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>CompCor_HCP</p></div>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Amanda Mejia, John Muschelli, Damon Pham.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.9000.9000.9000.</p>
</div>

      </footer></div>

  


  

  </body></html>

